## 가상메모리

**가상메모리**는 **프로세스 전체가 메모리 내에 올라오지 않더라도 실행이 가능하도록 하는 기법**이다. 어떤 프로세스가 차지하는 메모리가 전체 메모리 용량보다 크더라도 지금 현재 필요한 부분만 메모리에 적재되면 실행이 가능하기 때문에 **물리 메모리 용량을 초과하는 프로그램도 동작** 시킬 수 있는 큰 장점이 있다.

- 모든 프로그램들은 작은 조각들로 나눠지는데 조각들의 크기를 모두 같게하면 한 조각을 페이지(Page), 서로 다르게하면 조각들 각각을 세그먼트(Segment)라고 함

<br>

## Paging(페이징)

하나의 프로세스가 사용하는 메모리 공간이 연속적이어야 한다는 제약을 없애는 메모리 관리 방법이다. 외부 단편화와 압축 작업을 해소 하기 위해 생긴 방법론으로, **물리 메모리**는 **Frame** 이라는 **고정 크기**로 분리되어 있고, **논리 메모리**(프로세스가 점유하는)는 **페이지**라 불리는 **고정 크기**의 블록으로 분리된다.

페이징 기법을 사용함으로써 논리 메모리는 물리 메모리에 저장될 때, 연속되어 저장될 필요가 없고 물리 메모리의 남는 프레임에 적절히 배치됨으로 **외부 단편화를 해결**할 수 있는 큰 장점이 있다.

하나의 프로세스가 사용하는 공간은 여러개의 페이지로 나뉘어서 관리되고(논리 메모리에서), 개별 페이지는 순서에 상관없이 물리 메모리에 있는 프레임에 mapping 되어 저장된다고 볼 수 있다.

#### 단점

**내부 단편화 문제**의 비중이 늘어나게 된다. 예를들어 페이지 크기가 1,024B 이고 프로세스 A 가 3,172B 의 메모리를 요구한다면 3 개의 페이지 프레임(1,024 \* 3 = 3,072) 하고도 100B 가 남기때문에 총 4 개의 페이지 프레임이 필요한 것이다. 결론적으로 4 번째 페이지 프레임에는 924B(1,024 - 100)의 여유 공간이 남게 되는 내부 단편화 문제가 발생하는 것이다.

<br>

## Segmentation(세그멘테이션)

페이징에서처럼 논리 메모리와 물리 메모리를 같은 크기의 블록이 아닌, **서로 다른 크기의 논리적 단위인 세그먼트(Segment)** 로 분할한다.

세그먼트를 메모리에 할당할 때는 페이지를 할당하는 것과 동일하다. 하지만 테이블은 조금 다른데, 세그먼테이션을 위한 테이블은 세그먼트 테이블이라고한다. 그리고 세그먼트 테이블은 세그먼트 번호와 시작 주소(base), 세그먼트 크기(limit)를 엔트리로 갖는다.

#### 단점

서로 다른 크기의 세그먼트들이 메모리에 적재되고 제거되는 일이 반복되다 보면, 자유 공간들이 많은 수의 작은 조각들로 나누어져 못 쓰게 될 수도 있다. **(외부 단편화)**

<br>

## 가상메모리 관리 기법

### 1. 적재 정책

실행에 필요한 페이지를 언제 메모리에 적재할 것인가

#### 요구 적재 (요구 페이징)

요구 페이징은 페이지가 참조될 때 적재하는 기법이다. 적재해야할 요구가 있을때 하겠다는 기법으로, 참조되지않은 페이지는 메모리에 적재될 기회가 없다.

#### 예측 적재 (선 페이징)

예측을 통해 확률적으로 참조될 가능성이 높은 페이지를 미리 적재시키는 기법. 사용하는 경우는 드물다.

### 2. 배치 정책

디스크로부터 가져온 페이지를 메모리의 어디에 적재할 것인가

### 3. 할당 정책

프로세스들에게 메모리를 얼마큼씩 줄 것인가

### 4. 교체 정책

메모리에 빈 프레임이 없을때 적재될 페이지를 위해 적재된 페이지 중 누군가는 자신이 차지한 프레임을 비워줘야 하는 교체대상이 돼야한다. 이때 어떤 페이지를 선택할 것인가를 결정하는 정책이다.

#### 최적(Optimal) 기법

- 앞으로 가장 오랫동안 사용되지 않을 페이지를 찾아 교체하는 것
- 페이지 부재를 최소로 해주지만, 현실적으로 구현이 어려움

#### FIFO 기법

- 적재된지 가장 오래된 페이지를 교체하는 기법
- 단점
  - Belady의 모순: 페이지를 저장할 수 있는 페이지 프레임의 갯수를 늘려도 오히려 페이지 부재가 더 많이 발생하는 모순

#### LRU (Least-Recently-Used) 기법

- 가장 오랫동안 사용되지 않은 페이지를 선택하여 교체함

#### LFU (Least Frequently Used) 기법

- 많이 참조된 페이지는 앞으로도 참조될 확률이 높을 것이라고 판단, 가장 값이 작은 페이지를 선택한다.
- 구현되는 경우는 드물다

#### MFU (Most Frequently Used) 기법

- 많이 참조된 페이지는 충분히 참조가 이뤄져서 더이상 참조되지 않을것이라고 판단, 가장 값이 큰 페이지를 선택한다.
- 구현되는 경우는 드물다
